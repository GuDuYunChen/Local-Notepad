## 现状评估
- 获取方式：前端通过 `uploadFile` 返回完整 URL；未使用 base64，逻辑正确（src/components/Editor/utils/fileUpload.js:92-104）。
- 渲染机制：上传成功后插入 `ImageNode`，`decorate()` 返回 `<img>`，可正常显示（src/components/Editor/nodes/ImageNode.jsx:66-75, 92-96）。
- 样式：图片使用 `max-width:100%`、`height:auto` 保持比例（src/components/Editor/Editor.css:218-221），满足不变形要求。
- 多图：当前仅逐张插入，未提供统一的网格或轮播容器。
- 辅助信息：`alt` 仅用于下载按钮；未显示文件名的字幕/提示。
- 质量与速度：大图会压缩并同时上传原图与压缩图，默认展示压缩图（Toolbar/Paste 插件）；但 GIF/透明 PNG 被强制转为 JPEG 会丢动画/透明度。

## 问题清单
- GIF/透明 PNG 被压缩为 JPEG 导致动画/透明度丢失：需要条件跳过压缩或改用更合适格式。
- 多图展示缺少网格/轮播：需要新增节点或容器。
- 文件名未以小号文本或悬停提示展示：需要增加字幕或 `title`。
- 资源加载优化可加强：`loading="lazy"`、占位、清晰缩略图。

## 改造方案
### 1) 上传与压缩策略优化
- `fileUpload.js`：
  - 对 `image/gif` 直接跳过压缩，显示与保存均用原图 URL；避免动画丢失。
  - 对 `image/png` 检查透明通道（通过 `canvas` 提取像素简单判断 alpha>0 的占比）；若透明占比大则跳过转 JPEG，保留 PNG；否则压缩为 JPEG。
  - 统一返回 `{url, name}`，并在出错时抛出错误供调用方提示。
- `ToolbarPlugin.jsx` 与 `PasteImagePlugin.jsx`：
  - 使用上面的策略，`srcUrl` 仅在非 GIF/透明 PNG 时采用压缩图；否则使用原图。
  - 为 `<img>` 增加 `loading:"lazy"` 以提升加载速度。

### 2) 多图展示（网格/轮播）
- 新增 `ImageGridNode.jsx`（DecoratorNode）：
  - 属性：`items: Array<{src, originalSrc, alt}>`，`columns`（默认 3）、`gap`。
  - `decorate()` 返回 `<div class="editor-image-grid">`，内部按 `grid-template-columns: repeat(columns, 1fr)` 渲染图片卡片，卡片使用统一比例（例如 `aspect-ratio: 4 / 3`，`object-fit: contain`）。
  - 图片下方以小字号显示文件名；同时设置 `title` 悬停提示。
- `Editor.css`：
  - 添加 `.editor-image-grid` 与 `.editor-image-grid-item` 样式，含响应式断点（如 <=768px 降为 2 列）。
- `ToolbarPlugin.jsx`：
  - 将图片 `<input>` 改为 `multiple`。
  - 同时选择多张图片时，批量上传后生成 `ImageGridNode`；若只选择 1 张则继续插入单图节点。
- 轮播（可选）：
  - 提供简易左右切换按钮与当前索引状态；若 `columns === 1` 时以轮播样式渲染，支持自动播放开关。

### 3) 单图字幕/提示
- 扩展 `ImageNode`：
  - 新增 `__caption` 字段（默认为文件名），`exportJSON/importJSON` 同步。
  - `decorate()` 在图片下方渲染 `<div class="editor-image-caption">`，字体小、颜色次要；同时 `<img>` 设 `title={alt || caption}`。
- 样式：在 `Editor.css` 中添加 `.editor-image-caption`（如 `font-size: 12px; color:#666; margin-top:4px; text-align:center;`）。

### 4) 体验优化
- 懒加载：所有图片加 `loading="lazy"`。
- 占位与错误：加载失败显示占位图与重试按钮；上传过程中在 Toolbar 显示“上传/处理中…”。
- 保持比例：缩略图采用 `aspect-ratio` + `object-fit: contain`，不裁剪不变形；如需要更紧凑网格可切换 `cover`。

### 5) 后端契约检查
- 上传接口数据结构：`{ code, message, data: { url, filename, size } }`（server/internal/api/upload.go:56-66），已符合前端使用。
- 静态访问：`/uploads/xxx` 由服务端静态目录暴露，已可访问。
- 无需改动后端；若未来需要生成多尺寸缩略图，可扩展返回 `thumbUrl`。

## 改动文件一览
- 前端：
  - `src/components/Editor/utils/fileUpload.js`（条件压缩策略）。
  - `src/components/Editor/plugins/ToolbarPlugin.jsx`（multiple、批量上传、插入网格）。
  - `src/components/Editor/plugins/PasteImagePlugin.jsx`（跳过 GIF/透明 PNG 压缩）。
  - `src/components/Editor/nodes/ImageNode.jsx`（caption 字段与显示、lazy 属性）。
  - `src/components/Editor/Editor.css`（网格与字幕样式）。
  - 新增 `src/components/Editor/nodes/ImageGridNode.jsx`（网格/轮播渲染）。
  - `src/components/Editor/Editor.jsx`（注册 `ImageGridNode`）。

## 验证与测试
- 手动：
  - 上传 JPG/PNG/GIF（含透明 PNG、动图 GIF），检查是否预览正确、不变形。
  - 多选图片：是否以网格显示；小屏是否响应式；字幕与悬停提示是否工作。
  - 粘贴剪贴板图片：是否预览；GIF 是否保留动画。
- 自动：
  - 简单单元测试：模拟上传返回，确保节点序列化/反序列化包含 `caption` 与网格结构。
- 性能：
  - 大图上传是否优先展示压缩图；`loading="lazy"` 生效；滚动加载不卡顿。

## 交付说明
- 所有新增/修改代码将包含函数级与类级中文注释；
- 保持组件化、避免过深嵌套；及时清理事件监听与定时器；
- 不改动后端敏感配置；接口入参校验沿用现有机制。